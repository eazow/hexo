---
title: B-Tree叶节点格式
date: 2023-09-10 23:57:20
tags: Coding
categories: Coding
---



我们将表的格式从未排序的行数组更改为 B 树。这是一个相当大的改变，需要多篇文章来实现。在本文末尾，我们将定义叶节点的布局并支持将键/值对插入到单节点树中。但首先，让我们回顾一下切换到树结构的原因。



### 替代表格格式

使用当前格式，每个页面仅存储行（无元数据），因此空间效率很高。插入也很快，因为我们只是追加到末尾。但是，查找特定行只能通过扫描整个表来完成。如果我们想删除一行，我们必须通过移动它后面的每一行来填补这一行。

如果我们将表存储为数组，但保留按 id 排序的行，则可以使用二分搜索来查找特定 id。然而，插入会很慢，因为我们必须移动很多行来腾出空间。

相反，我们将采用树结构。树中的每个节点可以包含可变数量的行，因此我们必须在每个节点中存储一些信息以跟踪它包含多少行。另外，还有所有不存储任何行的内部节点的存储开销。作为更大的数据库文件的交换，我们获得了快速的插入、删除和查找。



|                | 未排序的行数组 | 已排序的行数组 | 节点树             |
| :------------- | :------------- | :------------- | :----------------- |
| 页面包含       | 仅数据         | 仅数据         | 元数据、主键和数据 |
| 每页行数       | 更多的         | 更多的         | 更少               |
| Insertion 插入 | O(1)           | O(n)           | O(log(n))          |
| Deletion 删除  | O(n)           | O(n)           | O(log(n))          |
| 通过id查找     | O(n)           | O(log(n))      | O(log(n))          |



### 转

https://cstack.github.io/db_tutorial/parts/part8.html
